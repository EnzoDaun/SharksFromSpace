# Sharks From Space - API# Sharks From Space - API````markdown



![CI Status](https://github.com/EnzoDaun/SharksFromSpace/workflows/CI%20-%20Build%20and%20Test/badge.svg)# Sharks From Space - API



API NestJS para an√°lise de dados oceanogr√°ficos e predi√ß√£o de atividade de tubar√µes usando dados de sat√©lite da NASA (Clorofila-a e Temperatura da Superf√≠cie do Mar) e an√°lise de IA.![CI Status](https://github.com/EnzoDaun/SharksFromSpace/workflows/CI%20-%20Build%20and%20Test/badge.svg)



## üöÄ FeaturesAPI NestJS para an√°lise de dados oceanogr√°ficos e predi√ß√£o de atividade de tubar√µes.



- ‚úÖ Integra√ß√£o com NASA GIBS (Global Imagery Browse Services)API NestJS para an√°lise de dados oceanogr√°ficos e predi√ß√£o de atividade de tubar√µes usando dados de sat√©lite da NASA (Clorofila-a e Temperatura da Superf√≠cie do Mar) e an√°lise de IA.

- ‚úÖ An√°lise de IA via OpenAI Assistant

- ‚úÖ Documenta√ß√£o interativa com Swagger## Desenvolvimento Local

- ‚úÖ CI/CD com GitHub Actions

- ‚úÖ Deploy no Render## üöÄ Features

- ‚úÖ Valida√ß√£o autom√°tica de requisi√ß√µes

- ‚úÖ CORS habilitado```bash



## üìö Documenta√ß√£o- ‚úÖ Integra√ß√£o com NASA GIBS (Global Imagery Browse Services)# Instalar depend√™ncias



### Swagger (API Docs)- ‚úÖ An√°lise de IA via OpenAI Assistant$ npm install

- **Local**: http://localhost:3000/api

- **Produ√ß√£o**: https://sharksfromspace-api.onrender.com/api- ‚úÖ Documenta√ß√£o interativa com Swagger



Veja [SWAGGER.md](./SWAGGER.md) para mais detalhes.- ‚úÖ CI/CD com GitHub Actions# Desenvolvimento



### CI/CD- ‚úÖ Deploy no Render$ npm run start:dev

O projeto usa GitHub Actions para testes automatizados em cada Pull Request.

- ‚úÖ Valida√ß√£o autom√°tica de requisi√ß√µes

Veja [CI.md](./CI.md) para mais detalhes.

- ‚úÖ CORS habilitado# Produ√ß√£o local

### Deploy

Deploy configurado para Render.$ npm run build



Veja [DEPLOY.md](./DEPLOY.md) e [RENDER_DEPLOY.md](./RENDER_DEPLOY.md) para instru√ß√µes completas.## üìö Documenta√ß√£o$ npm run start:prod



## üõ†Ô∏è Desenvolvimento Local```



```bash### Swagger (API Docs)

# Instalar depend√™ncias

npm install- **Local**: http://localhost:3000/api## Deploy na Vercel (Serverless)



# Desenvolvimento (com hot-reload)- **Produ√ß√£o**: https://sharks-from-space-api.onrender.com/api

npm run start:dev

### Configura√ß√£o do Projeto na Vercel

# Build

npm run buildVeja [SWAGGER.md](./SWAGGER.md) para mais detalhes.



# Produ√ß√£o local**Root Directory**: `api`  

npm run start:prod

```### CI/CD**Framework Preset**: `Other`  



Ap√≥s iniciar, acesse:O projeto usa GitHub Actions para testes automatizados em cada Pull Request.**Build Command**: `npm run build`  

- **API**: http://localhost:3000

- **Swagger**: http://localhost:3000/api**Output Directory**: (deixar vazio)



## üß™ TestesVeja [CI.md](./CI.md) para mais detalhes.



```bash### Environment Variables

# Testes unit√°rios

npm run test### Deploy



# Testes E2EDeploy configurado para Render.Configure na Vercel (Settings > Environment Variables):

npm run test:e2e



# Coverage

npm run test:covVeja [DEPLOY.md](./DEPLOY.md) e [RENDER_DEPLOY.md](./RENDER_DEPLOY.md) para instru√ß√µes completas.```bash



# Lint# NASA API Configuration (obrigat√≥rias)

npm run lint

```## üõ†Ô∏è Desenvolvimento LocalNASA_WMS_BASE=https://gibs.earthdata.nasa.gov/wms/epsg4326/best/wms.cgi



## üì° As 3 Rotas da APINASA_WMS_VERSION=1.1.1



### 1Ô∏è‚É£ Imagem de Clorofila-a```bashNASA_WMS_CRS=EPSG:4326



```bash# Instalar depend√™nciasNASA_LAYER_CHLA=MODIS_Aqua_Chlorophyll_A

curl --location 'https://sharksfromspace-api.onrender.com/nasa/chlorophyll.png?time=2024-05-15'

```npm installNASA_LAYER_SST=MODIS_Aqua_Sea_Surface_Temperature



- **Endpoint**: `GET /nasa/chlorophyll.png`NASA_DEFAULT_FORMAT=image/png

- **Par√¢metro**: `time` (formato: YYYY-MM-DD)

- **Resposta**: Imagem PNG de Clorofila-a# Copiar .env.example para .env e configurar



### 2Ô∏è‚É£ Imagem de Temperatura da Superf√≠cie do Mar (SST)cp .env.example .env# OpenAI Configuration



```bashOPENAI_API_KEY=your_openai_api_key_here

curl --location 'https://sharksfromspace-api.onrender.com/nasa/sst.png?time=2024-05-15'

```# Desenvolvimento (com hot-reload)OPENAI_BASE_URL=https://api.openai.com/v1



- **Endpoint**: `GET /nasa/sst.png`npm run start:devOPENAI_MODEL=gpt-4

- **Par√¢metro**: `time` (formato: YYYY-MM-DD)

- **Resposta**: Imagem PNG de SST



### 3Ô∏è‚É£ An√°lise de IA sobre Probabilidade de Tubar√µes# Build# Performance (opcionais)



```bashnpm run buildHTTP_TIMEOUT_MS=30000

curl --location 'https://sharksfromspace-api.onrender.com/openai/analyze?time=2024-05-15' \

--header 'Accept: text/html'HTTP_RETRY=3

```

# Produ√ß√£o localNODE_ENV=production

- **Endpoint**: `GET /openai/analyze`

- **Par√¢metro**: `time` (formato: YYYY-MM-DD)npm run start:prod```

- **Resposta**: JSON com campo `html` contendo an√°lise detalhada

```

**Exemplo de resposta:**

```json### Endpoints Dispon√≠veis

{

  "html": "<html><body><h1>An√°lise de Probabilidade de Tubar√µes</h1><p>Baseado nos dados de 2024-05-15...</p></body></html>"Ap√≥s iniciar, acesse:

}

```- API: http://localhost:3000- `GET /` - Status da API



## üîß Environment Variables- Swagger: http://localhost:3000/api- `GET /nasa/chlorophyll.png?time=YYYY-MM-DD` - Imagem de clorofila



Configure no `.env` local ou no dashboard do Render:- `GET /nasa/sst.png?time=YYYY-MM-DD` - Imagem de temperatura



```bash## üß™ Testes- `GET /nasa/maps?time=YYYY-MM-DD` - Ambas imagens em JSON

# Node

NODE_ENV=production- `GET /openai/analyze?time=YYYY-MM-DD` - An√°lise de probabilidade

PORT=3000

```bash

# NASA API

NASA_WMS_BASE=https://gibs.earthdata.nasa.gov/wms/epsg4326/best/wms.cgi# Testes unit√°rios### Exemplo de Teste

NASA_WMS_VERSION=1.3.0

NASA_WMS_CRS=EPSG:4326npm run test

NASA_LAYER_CHLA=OCI_PACE_Chlorophyll_a

NASA_LAYER_SST=GHRSST_L4_MUR_Sea_Surface_Temperature```bash

NASA_DEFAULT_FORMAT=image/png

# Testes E2E# Teste b√°sico

# HTTP

HTTP_TIMEOUT_MS=10000npm run test:e2ecurl https://seu-projeto.vercel.app/

HTTP_RETRY=2



# OpenAI

OPENAI_API_KEY=your_key_here# Coverage# Imagens NASA

OPENAI_MODEL=gpt-4o

OPENAI_BASE_URL=https://api.openai.com/v1npm run test:covcurl https://seu-projeto.vercel.app/nasa/chlorophyll.png?time=2024-05-15

OPENAI_ASSISTANT_ID=your_assistant_id

```curl https://seu-projeto.vercel.app/nasa/sst.png?time=2024-05-15



## üèóÔ∏è Arquitetura# Lint



```npm run lint# An√°lise OpenAI

src/

‚îú‚îÄ‚îÄ main.ts                 # Bootstrap + Swagger configcurl https://seu-projeto.vercel.app/openai/analyze?time=2024-05-15

‚îú‚îÄ‚îÄ app.module.ts           # M√≥dulo raiz

‚îú‚îÄ‚îÄ common/# Lint com auto-fix```

‚îÇ   ‚îú‚îÄ‚îÄ config/            # Configura√ß√£o e valida√ß√£o de env

‚îÇ   ‚îî‚îÄ‚îÄ utils/             # Utilit√°rios (bbox, date)npm run lint -- --fix

‚îú‚îÄ‚îÄ nasa/

‚îÇ   ‚îú‚îÄ‚îÄ nasa.controller.ts # 2 endpoints: chlorophyll.png e sst.png```## Arquitetura

‚îÇ   ‚îú‚îÄ‚îÄ usecases/          # L√≥gica de neg√≥cio

‚îÇ   ‚îú‚îÄ‚îÄ integration/       # Integra√ß√£o com NASA GIBS

‚îÇ   ‚îú‚îÄ‚îÄ dto/               # Data Transfer Objects

‚îÇ   ‚îî‚îÄ‚îÄ enums/             # Enums (layers, formats, etc)## üì° Endpoints Principais- **Framework**: NestJS + TypeScript

‚îî‚îÄ‚îÄ openai/

    ‚îú‚îÄ‚îÄ openai.controller.ts # 1 endpoint: analyze- **Deploy**: Serverless na Vercel

    ‚îú‚îÄ‚îÄ usecases/            # L√≥gica de an√°lise

    ‚îú‚îÄ‚îÄ integration/         # Integra√ß√£o com OpenAI### NASA Satellite Data- **Entrypoint**: `serverless.ts` (handler usando @vendia/serverless-express)

    ‚îî‚îÄ‚îÄ dto/                 # Data Transfer Objects

```- **CORS**: Habilitado para dom√≠nios `*.vercel.app`



## üîÑ CI/CD Pipeline- `GET /nasa/maps?time=YYYY-MM-DD` - Ambos os mapas (Clorofila e SST) em JSON



O projeto usa GitHub Actions para:- `GET /nasa/chlorophyll.png?time=YYYY-MM-DD` - Imagem PNG de Clorofila-a## Troubleshooting

- ‚úÖ Lint do c√≥digo

- ‚úÖ Build da aplica√ß√£o- `GET /nasa/sst.png?time=YYYY-MM-DD` - Imagem PNG de SST

- ‚úÖ Testes unit√°rios

- ‚úÖ Verifica√ß√£o de artefatos**404 Error**: Verifique Root Directory e se `serverless.ts` est√° commitado  



O CI roda automaticamente em:**Par√¢metros opcionais:****500 Error**: Verifique logs na Vercel e environment variables  

- Pull Requests para `main` ou `develop`

- Push nas branches `main` ou `develop`- `bbox`: Bounding box (minLon,minLat,maxLon,maxLat)**Logs**: Vercel > Functions > serverless.ts



## üì¶ Deploy no Render- `width`: Largura da imagem (px)



**Build Command**: `npm install && npm run build`  - `height`: Altura da imagem (px)---

**Start Command**: `npm run start:prod`  

**Root Directory**: `api`- `transparent`: Fundo transparente (true/false)



Veja [DEPLOY.md](./DEPLOY.md) para instru√ß√µes detalhadas.## Description



## ü§ù Contribuindo### OpenAI Analysis



1. Crie uma branch: `git checkout -b feature/minha-feature`[Nest](https://github.com/nestjs/nest) framework TypeScript starter repository.

2. Commit: `git commit -m 'feat: Adiciona minha feature'`

3. Push: `git push origin feature/minha-feature`- `GET /openai/analyze?time=YYYY-MM-DD` - An√°lise de probabilidade de tubar√µes

4. Abra um Pull Request

## Run tests

O CI rodar√° automaticamente e verificar√° se o build passa.

**Par√¢metros:**

## üìù License

- `time`: Data (obrigat√≥rio)```bash

Este projeto √© [MIT licensed](LICENSE).

- `regionHint`: Dica da regi√£o (opcional)# unit tests

## üîó Links √öteis

- `bbox`: Bounding box (opcional)$ npm run test

- [NestJS Documentation](https://docs.nestjs.com)

- [NASA GIBS API](https://wiki.earthdata.nasa.gov/display/GIBS)

- [OpenAI API](https://platform.openai.com/docs)

- [Swagger/OpenAPI](https://swagger.io/)### Health Check# e2e tests

- [Render Documentation](https://render.com/docs)

$ npm run test:e2e

- `GET /` - Retorna mensagem de boas-vindas

# test coverage

## üîß Environment Variables$ npm run test:cov

```

Configure no `.env` ou no dashboard do Render:

## Resources

```bash

# NodeCheck out a few resources that may come in handy when working with NestJS:

NODE_ENV=production

PORT=3000- Visit the [NestJS Documentation](https://docs.nestjs.com) to learn more about the framework.

- For questions and support, please visit our [Discord channel](https://discord.gg/G7Qnnhy).

# NASA API

NASA_WMS_BASE=https://gibs.earthdata.nasa.gov/wms/epsg4326/best/wms.cgi## License

NASA_WMS_VERSION=1.3.0

NASA_WMS_CRS=EPSG:4326Nest is [MIT licensed](https://github.com/nestjs/nest/blob/master/LICENSE).

NASA_LAYER_CHLA=OCI_PACE_Chlorophyll_a

NASA_LAYER_SST=GHRSST_L4_MUR_Sea_Surface_Temperature````

NASA_DEFAULT_FORMAT=image/png

## Description

# HTTP

HTTP_TIMEOUT_MS=10000[Nest](https://github.com/nestjs/nest) framework TypeScript starter repository.

HTTP_RETRY=2

## Project setup

# OpenAI

OPENAI_API_KEY=your_key_here```bash

OPENAI_MODEL=gpt-4o$ npm install

OPENAI_BASE_URL=https://api.openai.com/v1```

OPENAI_ASSISTANT_ID=your_assistant_id

```## Compile and run the project



## üèóÔ∏è Arquitetura```bash

# development

```$ npm run start

src/

‚îú‚îÄ‚îÄ app.module.ts           # M√≥dulo raiz# watch mode

‚îú‚îÄ‚îÄ main.ts                 # Bootstrap + Swagger config$ npm run start:dev

‚îú‚îÄ‚îÄ common/

‚îÇ   ‚îú‚îÄ‚îÄ config/            # Configura√ß√£o e valida√ß√£o de env# production mode

‚îÇ   ‚îî‚îÄ‚îÄ utils/             # Utilit√°rios (bbox, date)$ npm run start:prod

‚îú‚îÄ‚îÄ nasa/```

‚îÇ   ‚îú‚îÄ‚îÄ controllers/       # Endpoints NASA

‚îÇ   ‚îú‚îÄ‚îÄ usecases/         # L√≥gica de neg√≥cio## Run tests

‚îÇ   ‚îú‚îÄ‚îÄ integration/      # Integra√ß√£o com NASA GIBS

‚îÇ   ‚îú‚îÄ‚îÄ dto/              # Data Transfer Objects```bash

‚îÇ   ‚îî‚îÄ‚îÄ enums/            # Enums (layers, formats, etc)# unit tests

‚îî‚îÄ‚îÄ openai/$ npm run test

    ‚îú‚îÄ‚îÄ controllers/       # Endpoints OpenAI

    ‚îú‚îÄ‚îÄ usecases/         # L√≥gica de an√°lise# e2e tests

    ‚îú‚îÄ‚îÄ integration/      # Integra√ß√£o com OpenAI$ npm run test:e2e

    ‚îî‚îÄ‚îÄ dto/              # Data Transfer Objects

```# test coverage

$ npm run test:cov

## üîÑ CI/CD Pipeline```



O projeto usa GitHub Actions para:## Deployment

- ‚úÖ Lint do c√≥digo

- ‚úÖ Build da aplica√ß√£oWhen you're ready to deploy your NestJS application to production, there are some key steps you can take to ensure it runs as efficiently as possible. Check out the [deployment documentation](https://docs.nestjs.com/deployment) for more information.

- ‚úÖ Testes unit√°rios

- ‚úÖ Verifica√ß√£o de artefatosIf you are looking for a cloud-based platform to deploy your NestJS application, check out [Mau](https://mau.nestjs.com), our official platform for deploying NestJS applications on AWS. Mau makes deployment straightforward and fast, requiring just a few simple steps:



O CI roda automaticamente em:```bash

- Pull Requests para `main` ou `develop`$ npm install -g @nestjs/mau

- Push nas branches `main` ou `develop`$ mau deploy

```

## üì¶ Deploy

With Mau, you can deploy your application in just a few clicks, allowing you to focus on building features rather than managing infrastructure.

O projeto est√° configurado para deploy no **Render**.

## Resources

```bash

# Build commandCheck out a few resources that may come in handy when working with NestJS:

npm install && npm run build

- Visit the [NestJS Documentation](https://docs.nestjs.com) to learn more about the framework.

# Start command- For questions and support, please visit our [Discord channel](https://discord.gg/G7Qnnhy).

npm run start:prod- To dive deeper and get more hands-on experience, check out our official video [courses](https://courses.nestjs.com/).

```- Deploy your application to AWS with the help of [NestJS Mau](https://mau.nestjs.com) in just a few clicks.

- Visualize your application graph and interact with the NestJS application in real-time using [NestJS Devtools](https://devtools.nestjs.com).

Veja [DEPLOY.md](./DEPLOY.md) para instru√ß√µes detalhadas.- Need help with your project (part-time to full-time)? Check out our official [enterprise support](https://enterprise.nestjs.com).

- To stay in the loop and get updates, follow us on [X](https://x.com/nestframework) and [LinkedIn](https://linkedin.com/company/nestjs).

## ü§ù Contribuindo- Looking for a job, or have a job to offer? Check out our official [Jobs board](https://jobs.nestjs.com).



1. Crie uma branch: `git checkout -b feature/minha-feature`## Support

2. Commit: `git commit -m 'feat: Adiciona minha feature'`

3. Push: `git push origin feature/minha-feature`Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support by the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).

4. Abra um Pull Request

## Stay in touch

O CI rodar√° automaticamente e verificar√° se o build passa.

- Author - [Kamil My≈õliwiec](https://twitter.com/kammysliwiec)

## üìù License- Website - [https://nestjs.com](https://nestjs.com/)

- Twitter - [@nestframework](https://twitter.com/nestframework)

Este projeto √© [MIT licensed](LICENSE).

## License

## üîó Links √öteis

Nest is [MIT licensed](https://github.com/nestjs/nest/blob/master/LICENSE).

- [NestJS Documentation](https://docs.nestjs.com)
- [NASA GIBS API](https://wiki.earthdata.nasa.gov/display/GIBS)
- [OpenAI API](https://platform.openai.com/docs)
- [Swagger/OpenAPI](https://swagger.io/)
- [Render Documentation](https://render.com/docs)
